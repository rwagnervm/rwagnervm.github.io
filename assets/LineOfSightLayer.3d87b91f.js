import{j as l,iy as x,eg as H,jo as c,a6 as t,a7 as i,af as w,gw as O,a8 as f,a9 as P,iz as Z,c as n,cE as m,dy as C,_ as E,c_ as L,cZ as F,bc as b,u as z,jp as M,e9 as k,jq as B,jr as D,eF as G,eH as J,cF as K}from"./index.76c66e31.js";import{c as Q}from"./Analysis.d8604bae.js";import{g as h}from"./persistable.eba6be9f.js";import"./multiOriginJSONSupportUtils.38b69b9c.js";function R(e,s){return $(e)===$(s)}function $(e){if(l(e))return null;const s=e.layer!=null?e.layer.id:"";let r=null;return r=e.objectId!=null?e.objectId:e.layer!=null&&"objectIdField"in e.layer&&e.layer.objectIdField!=null&&e.attributes!=null?e.attributes[e.layer.objectIdField]:e.uid,r==null?null:`o-${s}-${r}`}const S={json:{write:{writer:U,target:{"feature.layerId":{type:[Number,String]},"feature.objectId":{type:[Number,String]}}},origins:{"web-scene":{read:V}}}};function U(e,s){var r;l(e)||((r=e.layer)==null?void 0:r.objectIdField)==null||e.attributes==null||(s.feature={layerId:e.layer.id,objectId:e.attributes[e.layer.objectIdField]})}function V(e){if(e.layerId!=null&&e.objectId!=null)return{uid:null,layer:{id:e.layerId,objectIdField:"ObjectId"},attributes:{ObjectId:e.objectId}}}let u=class extends x(H(P)){constructor(e){super(e),this.position=null,this.elevationInfo=null,this.feature=null}equals(e){return c(this.position,e.position)&&c(this.elevationInfo,e.elevationInfo)&&R(this.feature,e.feature)}};t([i({type:w}),h()],u.prototype,"position",void 0),t([i({type:O}),h()],u.prototype,"elevationInfo",void 0),t([i(S)],u.prototype,"feature",void 0),u=t([f("esri.analysis.LineOfSightAnalysisObserver")],u);const _=u;let p=class extends x(Z){constructor(e){super(e),this.position=null,this.elevationInfo=null,this.feature=null}equals(e){return c(this.position,e.position)&&c(this.elevationInfo,e.elevationInfo)&&R(this.feature,e.feature)}};t([i({type:w}),h()],p.prototype,"position",void 0),t([i({type:O}),h()],p.prototype,"elevationInfo",void 0),t([i(S)],p.prototype,"feature",void 0),p=t([f("esri.analysis.LineOfSightAnalysisTarget")],p);const q=p;function W(e){return e?ee:te}function X(e,s){return l(s)||!s.mode?W(e).mode:s.mode}function Y(e,s){return X(!!n(e)&&e.hasZ,s)}const ee={mode:"absolute-height",offset:0},te={mode:"on-the-ground",offset:null},v=m.ofType(q);let a=class extends Q{constructor(e){super(e),this.type="line-of-sight",this.observer=null,this.extent=null}initialize(){this.addHandles(E(()=>this._computeExtent(),e=>{(l(e)||l(e.pending))&&this._set("extent",n(e)?e.extent:null)},L))}get targets(){return this._get("targets")||new v}set targets(e){this._set("targets",F(e,this.targets,v))}get spatialReference(){return n(this.observer)&&n(this.observer.position)?this.observer.position.spatialReference:null}get requiredPropertiesForEditing(){return[b(this.observer,e=>e.position)]}async waitComputeExtent(){const e=this._computeExtent();return n(e)?z(e.pending):null}_computeExtent(){const e=this.spatialReference;if(l(this.observer)||l(this.observer.position)||l(e))return null;const s=y=>Y(y.position,y.elevationInfo)==="absolute-height",r=this.observer.position,j=M(r.x,r.y,r.z,r.x,r.y,r.z);for(const y of this.targets)if(n(y.position)){const d=k(y.position,e);if(n(d.pending))return{pending:d.pending,extent:null};if(n(d.geometry)){const{x:A,y:T,z:N}=d.geometry;B(j,[A,T,N])}}const g=D(j,e);return s(this.observer)&&this.targets.every(s)||(g.zmin=null,g.zmax=null),{pending:null,extent:g}}clear(){this.observer=null,this.targets.removeAll()}};t([i({type:["line-of-sight"]})],a.prototype,"type",void 0),t([i({type:_,json:{read:!0,write:!0}})],a.prototype,"observer",void 0),t([i({cast:C,type:v,nonNullable:!0,json:{read:!0,write:!0}})],a.prototype,"targets",null),t([i({value:null,readOnly:!0})],a.prototype,"extent",void 0),t([i({readOnly:!0})],a.prototype,"spatialReference",null),t([i({readOnly:!0})],a.prototype,"requiredPropertiesForEditing",null),a=t([f("esri.analysis.LineOfSightAnalysis")],a);const I=a,se=m.ofType(q);let o=class extends G(J(K)){constructor(e){super(e),this.type="line-of-sight",this.operationalLayerType="LineOfSightLayer",this.analysis=new I,this.opacity=1}initialize(){this.addHandles(E(()=>this.analysis,(e,s)=>{n(s)&&s.parent===this&&(s.parent=null),n(e)&&(e.parent=this)},L))}async load(){return n(this.analysis)&&this.addResolvingPromise(this.analysis.waitComputeExtent()),this}get observer(){return b(this.analysis,e=>e.observer)}set observer(e){b(this.analysis,s=>s.observer=e)}get targets(){return n(this.analysis)?this.analysis.targets:new m}set targets(e){var s;F(e,(s=this.analysis)==null?void 0:s.targets)}get fullExtent(){return n(this.analysis)?this.analysis.extent:null}get spatialReference(){return n(this.analysis)?z(this.analysis.spatialReference):null}releaseAnalysis(e){this.analysis===e&&(this.analysis=new I)}};t([i({json:{read:!1},readOnly:!0})],o.prototype,"type",void 0),t([i({type:["LineOfSightLayer"]})],o.prototype,"operationalLayerType",void 0),t([i({type:_,json:{read:!0,write:{ignoreOrigin:!0}}})],o.prototype,"observer",null),t([i({type:se,json:{read:!0,write:{ignoreOrigin:!0}}})],o.prototype,"targets",null),t([i({nonNullable:!0,json:{read:!1,write:!1}})],o.prototype,"analysis",void 0),t([i({readOnly:!0})],o.prototype,"fullExtent",null),t([i({readOnly:!0})],o.prototype,"spatialReference",null),t([i({readOnly:!0,json:{read:!1,write:!1,origins:{service:{read:!1,write:!1},"portal-item":{read:!1,write:!1},"web-document":{read:!1,write:!1}}}})],o.prototype,"opacity",void 0),t([i({type:["show","hide"]})],o.prototype,"listMode",void 0),o=t([f("esri.layers.LineOfSightLayer")],o);const ae=o;export{ae as default};
