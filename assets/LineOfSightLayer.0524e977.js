import{je as j,dw as _,jA as y,aa as e,ab as i,aj as I,f0 as x,ac as d,a9 as q,jf as P,c7 as g,g5 as T,a4 as w,fP as O,fO as $,jB as N,dy as C,jC as H,jD as V,dJ as B}from"./index.7eb0daf2.js";import{c as D}from"./Analysis.c7b5de3c.js";import{j as c}from"./persistable.730ba478.js";import{i as J}from"./elevationInfoUtils.42c7dcc4.js";import{S as M}from"./MultiOriginJSONSupport.b5976a45.js";import{b as k}from"./OperationalLayer.33897364.js";import"./MD5.f6d873db.js";import"./multiOriginJSONSupportUtils.e5f3496a.js";import"./resourceExtension.70831979.js";import"./commonProperties.a37169f8.js";function L(t,s){return b(t)===b(s)}function b(t){if(t==null)return null;const s=t.layer!=null?t.layer.id:"";let r=null;return r=t.objectId!=null?t.objectId:t.layer!=null&&"objectIdField"in t.layer&&t.layer.objectIdField!=null&&t.attributes!=null?t.attributes[t.layer.objectIdField]:t.uid,r==null?null:`o-${s}-${r}`}const S={json:{write:{writer:G,target:{"feature.layerId":{type:[Number,String]},"feature.objectId":{type:[Number,String]}}},origins:{"web-scene":{read:K}}}};function G(t,s){t?.layer?.objectIdField!=null&&t.attributes!=null&&(s.feature={layerId:t.layer.id,objectId:t.attributes[t.layer.objectIdField]})}function K(t){if(t.layerId!=null&&t.objectId!=null)return{uid:null,layer:{id:t.layerId,objectIdField:"ObjectId"},attributes:{ObjectId:t.objectId}}}let l=class extends j(_(q)){constructor(t){super(t),this.position=null,this.elevationInfo=null,this.feature=null}equals(t){return y(this.position,t.position)&&y(this.elevationInfo,t.elevationInfo)&&L(this.feature,t.feature)}};e([i({type:I,json:{write:{isRequired:!0}}})],l.prototype,"position",void 0),e([i({type:x}),c()],l.prototype,"elevationInfo",void 0),e([i(S)],l.prototype,"feature",void 0),l=e([d("esri.analysis.LineOfSightAnalysisObserver")],l);const R=l;let a=class extends j(P){constructor(t){super(t),this.position=null,this.elevationInfo=null,this.feature=null}equals(t){return y(this.position,t.position)&&y(this.elevationInfo,t.elevationInfo)&&L(this.feature,t.feature)}};e([i({type:I}),c()],a.prototype,"position",void 0),e([i({type:x}),c()],a.prototype,"elevationInfo",void 0),e([i(S)],a.prototype,"feature",void 0),a=e([d("esri.analysis.LineOfSightAnalysisTarget")],a);const E=a,f=g.ofType(E);let o=class extends D{constructor(t){super(t),this.type="line-of-sight",this.observer=null,this.extent=null}initialize(){this.addHandles(w(()=>this._computeExtent(),t=>{t?.pending==null&&this._set("extent",t!=null?t.extent:null)},O))}get targets(){return this._get("targets")||new f}set targets(t){this._set("targets",$(t,this.targets,f))}get spatialReference(){return this.observer?.position!=null?this.observer.position.spatialReference:null}get requiredPropertiesForEditing(){return[this.observer?.position]}async waitComputeExtent(){const t=this._computeExtent();return t!=null?t.pending:Promise.resolve()}_computeExtent(){const t=this.spatialReference;if(this.observer?.position==null||t==null)return null;const s=u=>J(u.position,u.elevationInfo)==="absolute-height",r=this.observer.position,v=N(r.x,r.y,r.z,r.x,r.y,r.z);for(const u of this.targets)if(u.position!=null){const p=C(u.position,t);if(p.pending!=null)return{pending:p.pending,extent:null};if(p.geometry!=null){const{x:F,y:z,z:A}=p.geometry;H(v,[F,z,A])}}const h=V(v,t);return s(this.observer)&&this.targets.every(s)||(h.zmin=void 0,h.zmax=void 0),{pending:null,extent:h}}clear(){this.observer=null,this.targets.removeAll()}};e([i({type:["line-of-sight"]})],o.prototype,"type",void 0),e([i({type:R,json:{read:!0,write:!0}})],o.prototype,"observer",void 0),e([i({cast:T,type:f,nonNullable:!0,json:{read:!0,write:!0}})],o.prototype,"targets",null),e([i({value:null,readOnly:!0})],o.prototype,"extent",void 0),e([i({readOnly:!0})],o.prototype,"spatialReference",null),e([i({readOnly:!0})],o.prototype,"requiredPropertiesForEditing",null),o=e([d("esri.analysis.LineOfSightAnalysis")],o);const m=o,Q=g.ofType(E);let n=class extends k(M(B)){constructor(t){super(t),this.type="line-of-sight",this.operationalLayerType="LineOfSightLayer",this.analysis=new m,this.opacity=1}initialize(){this.addHandles(w(()=>this.analysis,(t,s)=>{s!=null&&s.parent===this&&(s.parent=null),t!=null&&(t.parent=this)},O))}async load(){return this.analysis!=null&&this.addResolvingPromise(this.analysis.waitComputeExtent()),this}get observer(){return this.analysis?.observer}set observer(t){const{analysis:s}=this;s&&(s.observer=t)}get targets(){return this.analysis!=null?this.analysis.targets:new g}set targets(t){$(t,this.analysis?.targets)}get fullExtent(){return this.analysis!=null?this.analysis.extent:null}get spatialReference(){return this.analysis!=null?this.analysis.spatialReference:null}releaseAnalysis(t){this.analysis===t&&(this.analysis=new m)}};e([i({json:{read:!1},readOnly:!0})],n.prototype,"type",void 0),e([i({type:["LineOfSightLayer"]})],n.prototype,"operationalLayerType",void 0),e([i({type:R,json:{read:!0,write:{isRequired:!0,ignoreOrigin:!0}}})],n.prototype,"observer",null),e([i({type:Q,json:{read:!0,write:{ignoreOrigin:!0}}})],n.prototype,"targets",null),e([i({nonNullable:!0,json:{read:!1,write:!1}})],n.prototype,"analysis",void 0),e([i({readOnly:!0})],n.prototype,"fullExtent",null),e([i({readOnly:!0})],n.prototype,"spatialReference",null),e([i({readOnly:!0,json:{read:!1,write:!1,origins:{service:{read:!1,write:!1},"portal-item":{read:!1,write:!1},"web-document":{read:!1,write:!1}}}})],n.prototype,"opacity",void 0),e([i({type:["show","hide"]})],n.prototype,"listMode",void 0),n=e([d("esri.layers.LineOfSightLayer")],n);const rt=n;export{rt as default};
