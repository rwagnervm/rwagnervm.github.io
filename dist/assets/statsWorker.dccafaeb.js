import{eS as C,ax as S,af as R,u as j,de as A,aT as B,I as O,eT as k,eU as q}from"./index.9560fde2.js";import{O as G}from"./quantizationUtils.11b9a7de.js";import{c as E,x as U,m as Y,f as _,d as Z,V as H,T as J,F as K,D as L,N as Q,S as W}from"./utils.5f361291.js";import"./generateRendererUtils.635be5e9.js";let z=null;function X(e,a,o){return e.x<0?e.x+=a:e.x>o&&(e.x-=a),e}function aa(e,a,o,l){const n=C(o)?S(o):null,s=n?Math.round((n.valid[1]-n.valid[0])/a.scale[0]):null;return e.map(t=>{const i=new R(j(t.geometry));return G(a,i,i,i.hasZ,i.hasM),t.geometry=n?X(i,s,l[0]):i,t})}function ea(e,a=18,o,l,n,s){const t=new Float64Array(n*s);a=Math.round(O(a));let i=Number.POSITIVE_INFINITY,r=Number.NEGATIVE_INFINITY,m=0,f=0,d=0,c=0;const I=k(l,o);for(const{geometry:T,attributes:v}of e){const{x:p,y:u}=T,y=Math.max(0,p-a),V=Math.max(0,u-a),D=Math.min(s,u+a),g=Math.min(n,p+a),P=+I(v);for(let w=V;w<D;w++)for(let h=y;h<g;h++){const M=w*n+h,b=q(h-p,w-u,a),N=t[M];m=t[M]+=b*P;const $=m-N;f+=$,d+=$*$,m<i&&(i=m),m>r&&(r=m),c++}}if(!c)return{mean:0,stddev:0,min:0,max:0,mid:0,count:0};const x=(r-i)/2;return{mean:f/c,stdDev:Math.sqrt((d-f*f/c)/c),min:i,max:r,mid:x,count:c}}async function F(e,a){if(!a)return[];const{field:o,field2:l,field3:n,fieldDelimiter:s}=e,t=e.valueExpression,i=e.normalizationType,r=e.normalizationField,m=e.normalizationTotal,f=[],d=e.viewInfoParams;let c=null,I=null;if(t){if(!z){const{arcadeUtils:v}=await A();z=v}c=z.createFunction(t),I=d&&z.getViewInfo({viewingMode:d.viewingMode,scale:d.scale,spatialReference:new B(d.spatialReference)})}const x=e.fieldInfos,T=!(a[0]&&"declaredClass"in a[0]&&a[0].declaredClass==="esri.Graphic")&&x?{fields:x}:null;return a.forEach(v=>{const p=v.attributes;let u;if(t){const y=T?{...v,layer:T}:v,V=z.createExecContext(y,I);u=z.executeFunction(c,V)}else p&&(u=p[o],l&&(u=`${E(u)}${s}${E(p[l])}`,n&&(u=`${u}${s}${E(p[n])}`)));if(i&&typeof u=="number"&&isFinite(u)){const y=p&&parseFloat(p[r]);u=U(u,i,y,m)}f.push(u)}),f}async function oa(e){const{attribute:a,features:o}=e,{normalizationType:l,normalizationField:n,minValue:s,maxValue:t,fieldType:i}=a,r=await F({field:a.field,valueExpression:a.valueExpression,normalizationType:l,normalizationField:n,normalizationTotal:a.normalizationTotal,viewInfoParams:a.viewInfoParams,fieldInfos:a.fieldInfos},o),m=Y({normalizationType:l,normalizationField:n,minValue:s,maxValue:t}),f={value:.5,fieldType:i},d=i==="esriFieldTypeString"?_({values:r,supportsNullCount:m,percentileParams:f}):Z({values:r,minValue:s,maxValue:t,useSampleStdDev:!l,supportsNullCount:m,percentileParams:f});return H(d,i==="esriFieldTypeDate")}async function sa(e){const{attribute:a,features:o}=e,l=await F({field:a.field,field2:a.field2,field3:a.field3,fieldDelimiter:a.fieldDelimiter,valueExpression:a.valueExpression,viewInfoParams:a.viewInfoParams,fieldInfos:a.fieldInfos},o),n=J(l);return K(n,a.domains,a.returnAllCodedValues,a.fieldDelimiter)}async function ra(e){const{attribute:a,features:o}=e,{field:l,normalizationType:n,normalizationField:s,normalizationTotal:t,classificationMethod:i}=a,r=await F({field:l,valueExpression:a.valueExpression,normalizationType:n,normalizationField:s,normalizationTotal:t,viewInfoParams:a.viewInfoParams,fieldInfos:a.fieldInfos},o),m=L(r,{field:l,normalizationType:n,normalizationField:s,normalizationTotal:t,classificationMethod:i,standardDeviationInterval:a.standardDeviationInterval,numClasses:a.numClasses,minValue:a.minValue,maxValue:a.maxValue});return Q(m,i)}async function ma(e){const{attribute:a,features:o}=e,{field:l,normalizationType:n,normalizationField:s,normalizationTotal:t,classificationMethod:i}=a,r=await F({field:l,valueExpression:a.valueExpression,normalizationType:n,normalizationField:s,normalizationTotal:t,viewInfoParams:a.viewInfoParams,fieldInfos:a.fieldInfos},o);return W(r,{field:l,normalizationType:n,normalizationField:s,normalizationTotal:t,classificationMethod:i,standardDeviationInterval:a.standardDeviationInterval,numBins:a.numBins,minValue:a.minValue,maxValue:a.maxValue})}async function ua(e){const{attribute:a,features:o}=e,{field:l,radius:n,fieldOffset:s,transform:t,spatialReference:i,size:r}=a,m=aa(o,t,i,r),{count:f,min:d,max:c,mean:I,stdDev:x}=ea(m,n,s,l,r[0],r[1]);return{count:f,min:d,max:c,avg:I,stddev:x}}export{ra as classBreaks,ua as heatmapStatistics,ma as histogram,oa as summaryStatistics,sa as uniqueValues};
